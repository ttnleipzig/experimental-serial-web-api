<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Web Serial Beispiel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="">

    <main class="flex flex-col justify-center h-screen max-w-screen-lg px-4 mx-auto text-slate-700">
        <h1 class="text-4xl font-bold">Web Serial Example</h1>
        <p>
            This is an example of how to use the Web Serial API to connect to a serial device. This example will
            connect to a serial device at 115200 baud and print out all data that is received.

        <div class="p-4 my-3 rounded bg-sky-100 text-sky-800">
            <strong>Note:</strong>
            This example is only supported in Chrome and works with a serial device that is
            connected to your computer.
        </div>

        </p>
        <button id="connect"
            class="p-3 my-3 bg-blue-200 border rounded hover:bg-slate-200 active:bg-slate-300">Connect</button>
        <label for="log" class="text-align-left">Log:</label>
        <textarea id="log" readonly placeholder="Log output"
            class="w-full p-3 border rounded text-slate-500"></textarea>
    </main>
    <script>
        document.getElementById('connect').addEventListener('click', async () => {
            // Prüfen, ob der Browser Web Serial unterstützt
            if ('serial' in navigator) {
                try {
                    const port = await navigator.serial.requestPort() // Benutzer fragen, welchen Port er öffnen möchte
                    await port.open({baudRate: 115200}) // Port mit Baudrate öffnen

                    const writer = port.writable.getWriter()
                    const textEncoder = new TextEncoderStream()
                    const writableStreamClosed = textEncoder.readable.pipeTo(port.writable)

                    const reader = port.readable.getReader()

                    document.getElementById('log').textContent += 'Connected …\n'

                    while (true) { // Endlosschleife zum Lesen von Daten
                        const {value, done} = await reader.read() // Lese Daten vom Gerät

                        if (done) {
                            reader.releaseLock()
                            break
                        }

                        document.getElementById('log').textContent += new TextDecoder().decode(value)
                    }
                } catch (e) {
                    console.error(e)
                }
            } else {
                console.log('Your browser does not support the Web Serial API.')
            }
        });
    </script>

</body>

</html>
